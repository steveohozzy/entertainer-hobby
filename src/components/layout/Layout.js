import { Outlet, useNavigate } from "react-router-dom";
import { useState, useEffect } from "react";
import { ChevronUp, Heart } from "lucide-react";
import Menu from "../menu/Menu";

import { useSelector, useDispatch } from "react-redux";

import {
  selectCartCount,
  selectCartTotal,
  selectIsCartOpen,
} from "../../store/cart/cartSelector";

import { setIsCartOpen } from "../../store/cart/cartReducer";

import { selectWishlistItems, selectWishlistCount } from "../../store/wishlist/wishlistSelector";

import { setIsSignedIn } from "../../store/account/accountReducer";

import Footer from "../footer/Footer";
import MiniCart from "../miniCart/miniCart";
import SearchBar from "../searchBar/searchBar";
import AccountPopUp from "../accountPopUp/AccountPopUp";
import DeliveryStrip from "../deliveryStrip/DeliveryStrip";

const Layout = () => {
  const [showHeader, setShowHeader] = useState(true);
  const [lastScrollY, setLastScrollY] = useState(0);
  const [showBackToTop, setShowBackToTop] = useState(false);

  const cartCount = useSelector(selectCartCount);
  const cartTotal = useSelector(selectCartTotal);

  const dispatch = useDispatch();
  const navigate = useNavigate();
  const isCartOpen = useSelector(selectIsCartOpen);

  // Scroll to top
  const scrollToTop = () => {
    window.scrollTo({
      top: 0,
      left: 0,
      behavior: "smooth",
    });
  };

  // Handle scroll for header visibility
  useEffect(() => {
    const handleScroll = () => {
      const currentScrollY = window.scrollY;

      if (currentScrollY > lastScrollY && currentScrollY > 100) {
        // Scrolling down & past threshold
        setShowHeader(false);
      } else {
        // Scrolling up or at top
        setShowHeader(true);
      }

      if (currentScrollY > 400) {
        setShowBackToTop(true);
      } else {
        setShowBackToTop(false);
      }

      setLastScrollY(currentScrollY);
    };

    window.addEventListener("scroll", handleScroll, { passive: true });
    return () => window.removeEventListener("scroll", handleScroll);
  }, [lastScrollY]);

  const wishlistItems = useSelector(selectWishlistItems);
  const wishlistCount = useSelector(selectWishlistCount);

  useEffect(() => {
      localStorage.setItem("wishlistItems", JSON.stringify(wishlistItems));
    }, [wishlistItems])

  const toggleIsCartOpen = () => {
    dispatch(setIsCartOpen(!isCartOpen));

    if (isCartOpen) {
      document.body.classList.remove("body-noscroll");
    } else {
      document.body.classList.add("body-noscroll");
    }
  };

  const goToWishlistHandler = () => {
    dispatch(setIsSignedIn(true));
    navigate('/account');
  }

  return (
    <>
      <DeliveryStrip />
      <header
        id="site-header"
        className={`text-white rounded-b-2xl md:rounded-b-3xl sticky top-0 w-full z-[700] transition-transform duration-300 ${
          showHeader
            ? "translate-y-0"
            : "translate-y-[-100vh] shadow-none md:shadow-none"
        }`}
      >
        <div className="bg-black rounded-b-2xl md:rounded-b-3xl">
          <div className="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div className="flex items-stretch md:items-center justify-between">
              <div className="flex items-center">
                <Menu />
                <AccountPopUp />
                <button onClick={goToWishlistHandler} className="group flex md:hidden ml-2" name="View your favourites">
                    <Heart className="transition-all h-5 w-5 group-hover:scale-110 group-hover:rotate-[20deg]" fill="black" />
                    <span className="sr-only">View your favourites</span>
                </button>
              </div>
              <div className="flex items-center space-x-4 pt-2 ml-1  md:ml-0 group">
                <button onClick={() => {
                  navigate('/');
                   window.scrollTo({
                    top: 0,
                    left: 0,
                    behavior: "smooth",
                  });
                }} className="flex items-center ">
                  <svg className="shadow-text-green w-[300px]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 146 41" fill="none">
<path d="M19.6573 2.03275C20.6779 2.03275 21.4516 2.1915 21.9619 2.52488C22.4722 2.84238 22.7356 3.35038 22.7356 4.00126C22.7356 4.65214 22.4887 5.12839 21.9784 5.44589C21.4681 5.76339 20.6944 5.92214 19.6573 5.92214H16.1345V9.20828H19.1799C20.217 9.20828 20.9907 9.36703 21.501 9.68453C22.0113 10.002 22.2582 10.4942 22.2582 11.145C22.2582 11.7959 22.0113 12.288 21.501 12.6055C20.9907 12.923 20.217 13.0818 19.1799 13.0818H16.1345V16.5267H19.789C20.8261 16.5267 21.5998 16.6854 22.1101 17.0029C22.6204 17.3204 22.8673 17.8126 22.8673 18.4476C22.8673 19.0826 22.6204 19.5906 22.1101 19.9081C21.5998 20.2256 20.8261 20.3843 19.789 20.3843H14.7353C13.6159 20.3843 12.8422 20.1938 12.4307 19.8287C12.0191 19.4636 11.8051 18.7651 11.8051 17.7491V4.96964C11.8051 3.84251 12.0191 3.08051 12.4636 2.65188C12.908 2.22325 13.6817 2.01688 14.7847 2.01688H19.6573V2.03275Z" fill="black"/>
<path d="M23.9867 17.6221V9.43053C23.9867 8.4304 24.1513 7.68427 24.497 7.20802C24.8427 6.73177 25.3695 6.47777 26.0773 6.47777C26.5053 6.47777 26.884 6.58889 27.2132 6.79527C27.5424 7.01752 27.8387 7.33502 28.0857 7.77952C28.5301 7.30327 29.0569 6.95402 29.6495 6.73177C30.2421 6.50952 30.9664 6.39839 31.806 6.39839C33.4686 6.39839 34.7361 6.85877 35.6086 7.77952C36.4811 8.70028 36.9255 10.0338 36.9255 11.78V17.6221C36.9255 18.6222 36.7445 19.3683 36.3988 19.8604C36.0531 20.3526 35.5263 20.5907 34.802 20.5907C34.0777 20.5907 33.5509 20.3526 33.2052 19.8604C32.8595 19.3683 32.6784 18.6222 32.6784 17.6221V13.0183C32.6784 11.8753 32.4974 11.0657 32.1517 10.5894C31.806 10.1132 31.2134 9.85915 30.4067 9.85915C29.633 9.85915 29.0733 10.1132 28.7112 10.6053C28.349 11.1133 28.168 11.8912 28.168 12.9548V17.6221C28.168 18.6222 27.9869 19.3683 27.6412 19.8604C27.2955 20.3526 26.7687 20.5907 26.0444 20.5907C25.3201 20.5907 24.8098 20.3526 24.4641 19.8604C24.1184 19.3683 23.9538 18.6222 23.9538 17.6221H23.9867Z" fill="black"/>
<path d="M40.58 10.3989H40.4154C39.6746 10.3989 39.0985 10.2402 38.6705 9.92265C38.2425 9.60515 38.0449 9.17653 38.0449 8.63677C38.0449 8.09702 38.2589 7.65252 38.6705 7.35089C39.0985 7.04927 39.724 6.87464 40.5635 6.82702V5.03314C40.5635 4.03301 40.7446 3.28688 41.0903 2.79475C41.436 2.30263 41.9628 2.0645 42.6871 2.0645C43.4114 2.0645 43.9217 2.30263 44.2674 2.79475C44.6131 3.28688 44.7777 4.03301 44.7777 5.03314V6.82702H45.1399C45.9794 6.82702 46.6214 6.98577 47.0823 7.30327C47.5433 7.62077 47.7737 8.06527 47.7737 8.63677C47.7737 9.20828 47.5433 9.65278 47.0988 9.9544C46.6543 10.256 45.9794 10.3989 45.0905 10.3989H44.7448V17.6221C44.7448 18.6381 44.5802 19.3842 44.2345 19.8604C43.8888 20.3367 43.362 20.5907 42.6542 20.5907C41.9463 20.5907 41.4031 20.3526 41.0574 19.8604C40.7117 19.3683 40.5306 18.6222 40.5306 17.6221V10.3989H40.58Z" fill="black"/>
<path d="M52.1196 14.6693C52.2183 15.4313 52.5476 16.0346 53.0908 16.4632C53.6505 16.8918 54.3748 17.1141 55.2967 17.1141C56.0868 17.1141 56.9757 16.8918 57.947 16.4473C58.9182 16.0028 59.5108 15.7806 59.7413 15.7806C60.2351 15.7806 60.6467 15.9234 60.9595 16.2251C61.2722 16.5267 61.4368 16.8918 61.4368 17.3681C61.4368 18.2412 60.8113 19.0349 59.5438 19.7334C58.2762 20.4319 56.7947 20.7812 55.0991 20.7812C53.025 20.7812 51.28 20.0986 49.8973 18.7174C48.498 17.3522 47.8066 15.6218 47.8066 13.558C47.8066 11.4943 48.4816 9.74803 49.8314 8.35102C51.1813 6.96989 52.8768 6.27139 54.8851 6.27139C56.8934 6.27139 58.4573 6.92227 59.7742 8.22402C61.0911 9.52578 61.7496 11.1292 61.7496 13.0024C61.7496 13.6215 61.6014 14.0502 61.3216 14.2883C61.0418 14.5264 60.4821 14.6534 59.659 14.6534H52.136L52.1196 14.6693ZM52.0702 12.0023H57.6342C57.5848 11.3197 57.2885 10.7323 56.7782 10.2719C56.2514 9.81153 55.6424 9.5734 54.918 9.5734C54.1937 9.5734 53.5847 9.79565 53.0744 10.2243C52.564 10.6688 52.2348 11.2562 52.0867 11.9864L52.0702 12.0023Z" fill="black"/>
<path d="M63.1488 17.6221V9.43053C63.1488 8.4304 63.3134 7.68427 63.6591 7.20802C64.0048 6.73177 64.5316 6.47777 65.2394 6.47777C65.6674 6.47777 66.0461 6.58889 66.3753 6.79527C66.7045 7.01752 67.0008 7.33502 67.2477 7.77952C67.6757 7.31915 68.1367 6.98577 68.6305 6.74764C69.1244 6.50952 69.6018 6.39839 70.1121 6.39839C70.6882 6.39839 71.1985 6.60477 71.6265 7.00164C72.0545 7.39852 72.2521 7.87477 72.2521 8.41452C72.2521 9.22415 71.4784 9.90678 69.931 10.4624C69.3713 10.6529 68.9597 10.8117 68.6799 10.9387C68.1531 11.1768 67.791 11.4625 67.6264 11.7483C67.4453 12.0499 67.363 12.5897 67.363 13.3675V17.6062C67.363 18.6063 67.1819 19.3524 66.8362 19.8446C66.4905 20.3367 65.9637 20.5748 65.2394 20.5748C64.5151 20.5748 64.0048 20.3367 63.6591 19.8446C63.3134 19.3524 63.1488 18.6063 63.1488 17.6062V17.6221Z" fill="black"/>
<path d="M75.281 10.3989H75.1164C74.3756 10.3989 73.7995 10.2402 73.3715 9.92265C72.9435 9.60515 72.7459 9.17653 72.7459 8.63677C72.7459 8.09702 72.9599 7.65252 73.3715 7.35089C73.7995 7.04927 74.425 6.87464 75.2645 6.82702V5.03314C75.2645 4.03301 75.4456 3.28688 75.7913 2.79475C76.137 2.30263 76.6638 2.0645 77.3881 2.0645C78.1124 2.0645 78.6227 2.30263 78.9684 2.79475C79.3141 3.28688 79.4787 4.03301 79.4787 5.03314V6.82702H79.8409C80.6804 6.82702 81.3224 6.98577 81.7998 7.30327C82.2607 7.62077 82.4912 8.06527 82.4912 8.63677C82.4912 9.20828 82.2607 9.65278 81.8163 9.9544C81.3718 10.256 80.6969 10.3989 79.8079 10.3989H79.4622V17.6221C79.4622 18.6381 79.2976 19.3842 78.9519 19.8604C78.6062 20.3367 78.0795 20.5907 77.3716 20.5907C76.6638 20.5907 76.1205 20.3526 75.7748 19.8604C75.4292 19.3683 75.2481 18.6222 75.2481 17.6221V10.3989H75.281Z" fill="black"/>
<path d="M92.401 19.1778C91.973 19.6858 91.4627 20.0668 90.8536 20.3367C90.2446 20.6066 89.5861 20.7336 88.8783 20.7336C87.0839 20.7336 85.5695 20.0509 84.3349 18.6698C83.1002 17.3046 82.4911 15.5901 82.4911 13.5263C82.4911 11.4625 83.1332 9.79565 84.4007 8.39865C85.6682 7.01752 87.2156 6.31902 89.0429 6.31902C89.7507 6.31902 90.3927 6.43014 90.936 6.66827C91.4956 6.90639 91.973 7.27152 92.401 7.76365C92.648 7.33502 92.9278 7.01752 93.2735 6.79527C93.6192 6.57302 93.9978 6.46189 94.4094 6.46189C95.1172 6.46189 95.644 6.70002 95.9732 7.17627C96.3189 7.65252 96.4835 8.39865 96.4835 9.41465V17.6062C96.4835 18.6063 96.3189 19.3524 95.9732 19.8446C95.6275 20.3367 95.1172 20.5748 94.4094 20.5748C93.932 20.5748 93.5369 20.4637 93.2241 20.2414C92.8949 20.0192 92.6315 19.6541 92.401 19.1619V19.1778ZM86.837 13.4787C86.837 14.4788 87.0839 15.2884 87.5943 15.8917C88.1046 16.4949 88.763 16.8124 89.5696 16.8124C90.3763 16.8124 91.0018 16.5108 91.5121 15.8917C92.0224 15.2725 92.2693 14.4629 92.2693 13.4787C92.2693 12.4944 92.0224 11.7324 91.5121 11.1292C91.0018 10.5259 90.3598 10.2243 89.5696 10.2243C88.7795 10.2243 88.121 10.5259 87.6107 11.1292C87.1004 11.7324 86.8535 12.5103 86.8535 13.4787H86.837Z" fill="black"/>
<path d="M98.6565 3.04875C98.6565 2.39788 98.9034 1.84225 99.3808 1.38187C99.8582 0.921497 100.434 0.683371 101.109 0.683371C101.784 0.683371 102.344 0.921497 102.805 1.38187C103.282 1.84225 103.513 2.39788 103.513 3.04875C103.513 3.69963 103.282 4.25526 102.821 4.71564C102.36 5.17601 101.784 5.39826 101.126 5.39826C100.467 5.39826 99.8582 5.17601 99.3973 4.71564C98.9199 4.25526 98.6894 3.69963 98.6894 3.04875H98.6565ZM103.167 17.6379C103.167 18.6539 103.002 19.4001 102.657 19.8763C102.311 20.3526 101.801 20.6066 101.093 20.6066C100.385 20.6066 99.8417 20.3684 99.496 19.8763C99.1503 19.3842 98.9693 18.6381 98.9693 17.6379V9.4464C98.9693 8.44627 99.1339 7.70015 99.4796 7.22389C99.8253 6.74764 100.352 6.49364 101.076 6.49364C101.801 6.49364 102.311 6.73177 102.64 7.22389C102.986 7.70015 103.151 8.44627 103.151 9.4464V17.6379H103.167Z" fill="black"/>
<path d="M105.504 17.6221V9.43053C105.504 8.4304 105.669 7.68427 106.015 7.20802C106.36 6.73177 106.887 6.47777 107.595 6.47777C108.023 6.47777 108.402 6.58889 108.731 6.79527C109.06 7.00164 109.356 7.33502 109.603 7.77952C110.048 7.30327 110.575 6.95402 111.167 6.73177C111.76 6.50952 112.484 6.39839 113.324 6.39839C114.986 6.39839 116.254 6.85877 117.126 7.77952C117.999 8.70028 118.443 10.0338 118.443 11.78V17.6221C118.443 18.6222 118.262 19.3683 117.917 19.8604C117.571 20.3526 117.044 20.5907 116.32 20.5907C115.595 20.5907 115.069 20.3526 114.723 19.8604C114.377 19.3683 114.196 18.6222 114.196 17.6221V13.0183C114.196 11.8753 114.015 11.0657 113.669 10.5894C113.324 10.1132 112.731 9.85915 111.924 9.85915C111.151 9.85915 110.591 10.1132 110.229 10.6053C109.867 11.1133 109.686 11.8912 109.686 12.9548V17.6221C109.686 18.6222 109.505 19.3683 109.159 19.8604C108.813 20.3526 108.286 20.5907 107.562 20.5907C106.838 20.5907 106.328 20.3526 105.982 19.8604C105.636 19.3683 105.472 18.6222 105.472 17.6221H105.504Z" fill="black"/>
<path d="M124.732 14.6693C124.83 15.4313 125.16 16.0346 125.703 16.4632C126.263 16.8918 126.987 17.1141 127.909 17.1141C128.699 17.1141 129.588 16.8918 130.559 16.4473C131.53 16.0028 132.123 15.7806 132.353 15.7806C132.847 15.7806 133.259 15.9234 133.572 16.2251C133.884 16.5267 134.049 16.8918 134.049 17.3681C134.049 18.2412 133.423 19.0349 132.156 19.7334C130.888 20.4319 129.407 20.7812 127.711 20.7812C125.637 20.7812 123.892 20.0986 122.509 18.7174C121.11 17.3522 120.419 15.6218 120.419 13.558C120.419 11.4943 121.094 9.74803 122.443 8.35102C123.793 6.96989 125.489 6.27139 127.497 6.27139C129.506 6.27139 131.069 6.92227 132.386 8.22402C133.703 9.52578 134.362 11.1292 134.362 13.0024C134.362 13.6215 134.214 14.0502 133.934 14.2883C133.654 14.5264 133.094 14.6534 132.271 14.6534H124.748L124.732 14.6693ZM124.682 12.0023H130.246C130.197 11.3197 129.901 10.7323 129.39 10.2719C128.864 9.81153 128.238 9.5734 127.53 9.5734C126.822 9.5734 126.197 9.79565 125.686 10.2243C125.176 10.6688 124.847 11.2562 124.699 11.9864L124.682 12.0023Z" fill="black"/>
<path d="M136.205 17.6221V9.43053C136.205 8.4304 136.37 7.68427 136.716 7.20802C137.061 6.73177 137.588 6.47777 138.296 6.47777C138.724 6.47777 139.103 6.58889 139.432 6.79527C139.761 7.00164 140.057 7.33502 140.304 7.77952C140.732 7.31915 141.193 6.98577 141.687 6.74764C142.181 6.50952 142.658 6.39839 143.169 6.39839C143.745 6.39839 144.255 6.60477 144.683 7.00164C145.111 7.39852 145.309 7.87477 145.309 8.41452C145.309 9.22415 144.535 9.90678 142.987 10.4624C142.428 10.6529 142.016 10.8117 141.736 10.9387C141.21 11.1768 140.847 11.4625 140.683 11.7483C140.518 12.034 140.419 12.5897 140.419 13.3675V17.6062C140.419 18.6063 140.238 19.3524 139.893 19.8446C139.547 20.3367 139.02 20.5748 138.296 20.5748C137.572 20.5748 137.061 20.3367 136.716 19.8446C136.37 19.3524 136.205 18.6063 136.205 17.6062V17.6221Z" fill="black"/>
<path d="M2.80066 18.6381V19.3207C2.80066 19.7652 2.73481 20.0986 2.58666 20.3208C2.4385 20.5431 2.2245 20.6383 1.91173 20.6383C1.59896 20.6383 1.38496 20.5272 1.23681 20.3049C1.08865 20.0827 1.00635 19.7493 1.00635 19.3048V16.0822C1.00635 15.6377 1.08865 15.3043 1.23681 15.0979C1.38496 14.8757 1.61543 14.7645 1.91173 14.7645C2.20804 14.7645 2.4385 14.8757 2.58666 15.0979C2.73481 15.3202 2.80066 15.6535 2.80066 16.0981V16.7807H8.20006C8.66099 16.7807 9.00668 16.8601 9.22068 17.0029C9.45114 17.1617 9.54991 17.3839 9.54991 17.7014C9.54991 18.0189 9.43468 18.2412 9.22068 18.3999C8.99022 18.5587 8.66099 18.6222 8.20006 18.6222H2.80066V18.6381Z" fill="black"/>
<path d="M3.60727 12.5738C3.39327 12.3833 3.24512 12.161 3.14635 11.9229C3.04758 11.6848 3.01465 11.3832 3.01465 11.018C3.01465 10.3037 3.22865 9.7639 3.64019 9.3829C4.06819 9.0019 4.67727 8.8114 5.48389 8.8114H8.16713C8.62805 8.8114 8.97375 8.89078 9.18775 9.03365C9.41821 9.17653 9.51698 9.41465 9.51698 9.71628C9.51698 10.0179 9.40175 10.256 9.18775 10.3989C8.95728 10.5418 8.62805 10.6212 8.16713 10.6212H6.04358C5.51681 10.6212 5.15466 10.7005 4.9242 10.8434C4.69374 11.0022 4.59497 11.2403 4.59497 11.5895C4.59497 11.9229 4.7102 12.161 4.94066 12.3198C5.17112 12.4785 5.53328 12.5579 6.02712 12.5579H8.16713C8.62805 12.5579 8.97375 12.6373 9.18775 12.7802C9.41821 12.923 9.51698 13.1612 9.51698 13.4628C9.51698 13.7644 9.40175 14.0025 9.18775 14.1454C8.95728 14.2883 8.62805 14.3677 8.16713 14.3677H1.74711C1.28619 14.3677 0.940494 14.2883 0.710031 14.1454C0.479569 14.0025 0.380798 13.7644 0.380798 13.4628C0.380798 13.1612 0.496028 12.923 0.72649 12.7802C0.956952 12.6373 1.30265 12.5579 1.74711 12.5579H3.60727V12.5738Z" fill="black"/>
<path d="M6.81726 6.12852C7.16296 6.08089 7.4428 5.95389 7.64034 5.71576C7.83788 5.47764 7.93665 5.16014 7.93665 4.76326C7.93665 4.42989 7.83788 4.04888 7.62388 3.63613C7.42634 3.22338 7.31111 2.96938 7.31111 2.87413C7.31111 2.66775 7.37696 2.49313 7.50865 2.35025C7.64035 2.22325 7.82142 2.14388 8.03542 2.14388C8.4305 2.14388 8.79266 2.41375 9.12189 2.9535C9.45112 3.49326 9.59927 4.12826 9.59927 4.85851C9.59927 5.74752 9.2865 6.49364 8.66096 7.0969C8.03542 7.70015 7.24526 7.9859 6.29049 7.9859C5.33572 7.9859 4.54556 7.70015 3.90356 7.11277C3.26156 6.52539 2.94879 5.81102 2.94879 4.93789C2.94879 4.06476 3.2451 3.39801 3.85418 2.84238C4.44679 2.27088 5.18757 2.001 6.06003 2.001C6.33988 2.001 6.53742 2.0645 6.65265 2.1915C6.76788 2.3185 6.81726 2.55663 6.81726 2.90588V6.12852ZM5.59911 6.14439V3.76313C5.28634 3.77901 5.02295 3.90601 4.80895 4.12826C4.59495 4.35051 4.49618 4.62039 4.49618 4.92201C4.49618 5.22364 4.59495 5.49351 4.79249 5.71576C4.99003 5.93802 5.26988 6.08089 5.59911 6.14439Z" fill="black"/>
</svg>
                </button>
              </div>
              <div className="flex items-center space-x-4">
                <button onClick={goToWishlistHandler} className="group hidden md:flex" name="View your favourites">
                    <Heart className="transition-all h-5 w-5 group-hover:scale-110 group-hover:rotate-[20deg]" fill="black" />
                    <span className="sr-only">View your favourites</span>
                    {wishlistCount > 0 &&
                      <div className="ml-1 text-xs bg-brandRed w-[20px] h-[20px] flex items-center justify-center rounded-full z-20">
                          <span className="ml-[-1px] w-full text-center">{wishlistCount}</span>
                      </div>
                    }
                </button>
                <div className="relative">
                    <button
                    onClick={toggleIsCartOpen}
                    name="View cart"
                    className="flex items-center  text-white group"
                    >
                    <span
                        className={`transition-all group-hover:rotate-[25deg] relative z-20 ${
                        isCartOpen ? "text-brandBlue" : "text-white"
                        }`}
                    >
                        <svg
                        width="22"
                        height="18"
                        viewBox="0 0 22 18"
                        fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg"
                        >
                        <path d="M21.2401 7.57V8.14C21.2401 8.38 21.1601 8.58 20.9901 8.75C20.8201 8.92 20.6201 9 20.3801 9H20.0901L19.1601 15.57C19.0901 16 18.8901 16.35 18.5701 16.63C18.2501 16.9 17.8701 17.04 17.4401 17.04H4.36006C3.93006 17.04 3.55006 16.9 3.23006 16.63C2.91006 16.35 2.71006 16 2.64006 15.57L1.71006 9H1.42006C1.18006 9 0.980059 8.92 0.810059 8.75C0.640059 8.58 0.560059 8.38 0.560059 8.14V7.57C0.560059 7.33 0.640059 7.13 0.810059 6.96C0.980059 6.79 1.18006 6.71 1.42006 6.71H3.83006L7.67006 1.43C7.86006 1.17 8.11006 1.01 8.42006 0.960001C8.73006 0.910001 9.02006 0.980002 9.28006 1.18C9.54006 1.37 9.70006 1.62 9.75006 1.93C9.80006 2.24 9.73006 2.53 9.53006 2.79L6.66006 6.71H15.1401L12.2701 2.79C12.0801 2.53 12.0101 2.24 12.0501 1.93C12.1001 1.62 12.2501 1.37 12.5201 1.18C12.7801 0.990002 13.0701 0.920001 13.3801 0.960001C13.6901 1.01 13.9401 1.16 14.1301 1.43L17.9701 6.71H20.3801C20.6201 6.71 20.8201 6.79 20.9901 6.96C21.1601 7.13 21.2401 7.33 21.2401 7.57ZM7.73006 13.89V9.87C7.73006 9.63 7.65006 9.43 7.48006 9.26C7.31006 9.09 7.11006 9.01 6.87006 9.01C6.63006 9.01 6.43006 9.09 6.26006 9.26C6.09006 9.43 6.01006 9.63 6.01006 9.87V13.89C6.01006 14.13 6.09006 14.33 6.26006 14.5C6.43006 14.67 6.63006 14.75 6.87006 14.75C7.11006 14.75 7.31006 14.67 7.48006 14.5C7.65006 14.33 7.73006 14.13 7.73006 13.89ZM11.7501 13.89V9.87C11.7501 9.63 11.6701 9.43 11.5001 9.26C11.3301 9.09 11.1301 9.01 10.8901 9.01C10.6501 9.01 10.4501 9.09 10.2801 9.26C10.1101 9.43 10.0301 9.63 10.0301 9.87V13.89C10.0301 14.13 10.1101 14.33 10.2801 14.5C10.4501 14.67 10.6501 14.75 10.8901 14.75C11.1301 14.75 11.3301 14.67 11.5001 14.5C11.6701 14.33 11.7501 14.13 11.7501 13.89ZM15.7701 13.89V9.87C15.7701 9.63 15.6901 9.43 15.5201 9.26C15.3501 9.09 15.1501 9.01 14.9101 9.01C14.6701 9.01 14.4701 9.09 14.3001 9.26C14.1301 9.43 14.0501 9.63 14.0501 9.87V13.89C14.0501 14.13 14.1301 14.33 14.3001 14.5C14.4701 14.67 14.6701 14.75 14.9101 14.75C15.1501 14.75 15.3501 14.67 15.5201 14.5C15.6901 14.33 15.7701 14.13 15.7701 13.89Z" />
                        </svg>
                    </span>

                    <div className="ml-1 text-xs bg-brandRed w-[24px] h-[24px] flex items-center justify-center rounded-full relative z-20">
                        {cartCount}
                    </div>
                    <span className="sr-only">View your cart</span>
                    <span className="text-sm ml-2 hidden md:block">
                        £{cartTotal.toFixed(2)}
                    </span>
                    {isCartOpen && (
                        <span className="absolute bg-white left-[-5px] bottom-[-30px] lg:bottom-[-40px] h-[calc(100%+40px)] lg:h-[calc(100%+60px)] w-[60px] rounded-tl-lg rounded-tr-lg">
                        &nbsp;
                        </span>
                    )}
                    </button>
                    <MiniCart />
                </div>
                <a
                  href="https://www.elc.co.uk/"
                  rel="noreferrer"
                  target="_blank"
                  className="py-2 h-full md:h-auto flex items-center rounded-md rounded-tr-[0] rounded-br-xl md:rounded-br-2xl md:rounded-tr-md md:rounded-br-md px-2 md:px-3 bg-white hover:bg-grey-100 transition-all hover:scale-105 hover:shadow-md"
                >
                  <img
                    src="/elc-logo-full.svg"
                    alt="visit Early Learning Centre"
                    className="h-7 hidden md:block"
                  />
                  <img
                    src="/elc-logo-small.svg"
                    alt="visit Early Learning Centre"
                    className="h-7 md:hidden"
                  />
                  <span className="sr-only">
                    visit the Early Learning Centre website
                  </span>
                </a>
              </div>
            </div>
          </div>
        </div>
        <SearchBar />
      </header>
      <div className="selection:bg-purple-300 selection:text-purple-900">
        <Outlet />
        <Footer />
      </div>
      {showBackToTop && (
        <button
          name="Scroll to to of site"
          onClick={scrollToTop}
          className="fixed border-[2px] border-brandBlue bottom-4 right-4 inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm text-brandBlue bg-brandLightBlue hover:bg-brandBlue h-9 rounded-full px-2 shadow-md transition-all hover:scale-105 hover:shadow-lg hover:text-white hover:border-white z-[9999]"
        >
          <ChevronUp className="h-5 w-5" />
          <span className="sr-only">Back to top</span>
        </button>
      )}
    </>
  );
};

export default Layout;
